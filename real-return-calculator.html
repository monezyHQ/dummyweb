<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real Return Calculator (India) - FD, MF SIP, MF Lumpsum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb; /* Light gray background */
        }
        /* Robinhood-inspired theme colors */
        :root {
            --rh-green: #00c805; /* Robinhood Green */
            --rh-dark-green: #00a300;
            --rh-text: #1b1b1d; /* Dark text */
            --rh-border: #e3e3e3; /* Light border */
            --rh-bg-light-green: #f0fdf4; /* Lighter green background for insights */
            --rh-insight-border: #bbf7d0; /* Green border for insights */
        }
        .rh-bg-green { background-color: var(--rh-green); }
        .rh-text-green { color: var(--rh-green); }
        .rh-border-green { border-color: var(--rh-green); }
        .rh-text-dark { color: var(--rh-text); }
        .rh-border-light { border-color: var(--rh-border); }

        /* Custom button style */
        .btn-calculate {
            background-color: var(--rh-green);
            color: white;
            padding: 0.6rem 1.5rem;
            border-radius: 9999px; /* Pill shape */
            font-weight: 600;
            transition: background-color 0.2s ease;
            border: none;
            cursor: pointer;
            display: inline-block;
            position: relative;
            overflow: hidden;
        }
        .btn-calculate:hover {
            background-color: var(--rh-dark-green);
        }
        .btn-calculate:disabled {
            background-color: #9ca3af; /* gray-400 */
            cursor: not-allowed;
        }

        /* Input field styling */
        .input-field {
            border: 1px solid var(--rh-border);
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem 0.75rem;
            width: 100%;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .input-field:focus {
            outline: none;
            border-color: var(--rh-green);
            box-shadow: 0 0 0 2px rgba(0, 200, 5, 0.2);
        }

        /* Card styling (used for overall container) */
        .calculator-container {
            background-color: white;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            border: 1px solid var(--rh-border-light);
            overflow: hidden; /* Contain children */
        }

        /* Tab styling */
        .tab-buttons {
            display: flex;
            background-color: #f3f4f6; /* gray-100 */
            border-bottom: 1px solid var(--rh-border-light);
        }
        .tab-button {
            padding: 0.75rem 1rem; /* Adjusted padding for more tabs */
            cursor: pointer;
            border: none;
            background: none;
            font-weight: 500;
            color: #6b7280; /* gray-500 */
            border-bottom: 3px solid transparent; /* For active indicator */
            transition: color 0.2s ease, border-color 0.2s ease;
            flex-grow: 1; /* Make tabs fill width */
            text-align: center; /* Center text */
            font-size: 0.875rem; /* Slightly smaller font */
        }
        .tab-button:hover {
            color: var(--rh-text-dark);
        }
        .tab-button.active {
            color: var(--rh-green);
            border-bottom-color: var(--rh-green);
            font-weight: 600;
        }
        .tab-content {
            padding: 1.5rem; /* p-6 */
        }

        /* Result display styling */
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.6rem 0;
            border-bottom: 1px dashed var(--rh-border-light);
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .result-label {
            color: #6b7280; /* gray-500 */
            font-size: 0.875rem; /* text-sm */
            margin-right: 1rem;
            display: flex; /* Align icon with text */
            align-items: center;
        }
        .result-value {
            font-weight: 600;
            color: var(--rh-text-dark);
            text-align: right;
            white-space: nowrap;
        }
        .result-value.positive { color: #10b981; /* emerald-600 */ }
        .result-value.negative { color: #ef4444; /* red-500 */ }

        /* Info icon and Tooltip */
        .info-icon-container {
            position: relative;
            display: inline-block;
            margin-left: 0.3rem;
        }
        .info-icon {
            display: inline-block;
            width: 1rem; height: 1rem; line-height: 1rem;
            text-align: center; border-radius: 9999px;
            background-color: #d1d5db; color: white;
            font-size: 0.7rem; font-style: normal; font-weight: bold;
            cursor: help;
        }
        .tooltip-text {
            visibility: hidden; width: max-content; max-width: 250px;
            background-color: #374151; color: #fff; text-align: left;
            border-radius: 0.375rem; padding: 0.5rem 0.75rem;
            position: absolute; z-index: 10; bottom: 125%; left: 50%;
            transform: translateX(-50%); opacity: 0; transition: opacity 0.3s;
            font-size: 0.75rem; font-weight: normal; white-space: normal;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .tooltip-text::after {
            content: ""; position: absolute; top: 100%; left: 50%;
            margin-left: -5px; border-width: 5px; border-style: solid;
            border-color: #374151 transparent transparent transparent;
        }
        .info-icon-container:hover .tooltip-text {
            visibility: visible; opacity: 1;
        }

        /* News-like Insights Styling */
        .insights-container {
            margin-top: 1.5rem;
            border-top: 1px solid var(--rh-border-light);
            padding-top: 1.5rem;
        }
        .insights-container h4 {
             font-weight: 600;
             color: var(--rh-dark-green);
             margin-bottom: 1rem; /* Increased margin */
             font-size: 1.125rem; /* text-lg */
        }
        .insight-item {
            display: flex;
            align-items: flex-start; /* Align icon to top */
            background-color: var(--rh-bg-light-green);
            border: 1px solid var(--rh-insight-border);
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1rem; /* p-4 */
            margin-bottom: 0.75rem; /* mb-3 */
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            transition: box-shadow 0.2s ease;
        }
         .insight-item:hover {
             box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
         }
        .insight-icon {
            flex-shrink: 0; /* Prevent icon from shrinking */
            width: 1.75rem; /* w-7 */
            height: 1.75rem; /* h-7 */
            margin-right: 0.75rem; /* mr-3 */
            color: var(--rh-dark-green);
            background-color: #dcfce7; /* Lighter green for icon bg */
            border-radius: 9999px; /* rounded-full */
            display: flex;
            align-items: center;
            justify-content: center;
        }
         .insight-icon i { /* Style Font Awesome icon */
             font-size: 0.875rem; /* text-sm */
         }
        .insight-text {
            font-size: 0.875rem; /* text-sm */
            color: #374151; /* gray-700 */
            line-height: 1.4; /* Slightly increased line height */
        }
         .insight-text strong { /* Make bold parts stand out */
            color: #1f2937; /* gray-800 */
            font-weight: 600;
         }


        /* Error message styling */
        .error-message {
            color: #dc2626; background-color: #fee2e2; border: 1px solid #fca5a5;
            border-radius: 0.375rem; padding: 0.75rem; margin-top: 1rem;
            font-size: 0.875rem; display: none;
        }
    </style>
</head>
<body class="rh-text-dark">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8 md:mb-12">
            <h1 class="text-3xl md:text-4xl font-bold rh-text-green mb-2">Investment Real Return Calculator</h1>
            <p class="text-lg text-gray-600">Analyze your Indian investments after tax and inflation.</p>
        </header>

        <div class="mb-6 p-6 bg-white rounded-xl shadow border border-gray-200">
             <label for="inflationRate" class="block text-sm font-medium text-gray-700 mb-1">Estimated Annual Inflation Rate (%)</label>
             <input type="number" id="inflationRate" class="input-field" placeholder="e.g., 6" value="6">
             <p class="text-xs text-gray-500 mt-1">Enter the expected average annual inflation rate over your investment period. (Used for FD/MF Real Return)</p>
             <div id="globalErrorMessage" class="error-message"></div>
        </div>

        <div class="calculator-container">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="switchTab('fd')">Fixed Deposit</button>
                <button class="tab-button" onclick="switchTab('mfSip')">MF (SIP)</button>
                <button class="tab-button" onclick="switchTab('mfLumpsum')">MF (Lumpsum)</button>
            </div>

            <div>
                <div id="fd-tab-content" class="tab-content">
                    <h2 class="text-xl font-semibold mb-4 rh-text-dark">Fixed Deposit (FD) Calculator</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="fdPrincipal" class="block text-sm font-medium text-gray-700 mb-1">Principal Amount (₹)</label>
                            <input type="number" id="fdPrincipal" class="input-field" placeholder="e.g., 100000">
                        </div>
                        <div>
                            <label for="fdRate" class="block text-sm font-medium text-gray-700 mb-1">Annual Interest Rate (%)</label>
                            <input type="number" id="fdRate" class="input-field" placeholder="e.g., 7.5">
                        </div>
                        <div>
                            <label for="fdTime" class="block text-sm font-medium text-gray-700 mb-1">Time Period (Years)</label>
                            <input type="number" id="fdTime" class="input-field" placeholder="e.g., 5">
                        </div>
                        <div>
                            <label for="fdCompoundFreq" class="block text-sm font-medium text-gray-700 mb-1">Compounding Frequency</label>
                            <select id="fdCompoundFreq" class="input-field">
                                <option value="1">Yearly</option>
                                <option value="4" selected>Quarterly</option>
                                <option value="12">Monthly</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label for="fdTaxBracket" class="block text-sm font-medium text-gray-700 mb-1">Your Income Tax Slab (%)</label>
                            <select id="fdTaxBracket" class="input-field">
                                <option value="0">0%</option>
                                <option value="5">5%</option>
                                <option value="10">10%</option>
                                <option value="15">15%</option>
                                <option value="20">20%</option>
                                <option value="30" selected>30%</option>
                            </select>
                            <p class="text-xs text-gray-500 mt-1">Select the slab applicable to your total income (excluding cess/surcharge).</p>
                        </div>
                    </div>
                    <button id="fdCalculateBtn" onclick="calculateFD(this)" class="btn-calculate mb-4">Calculate FD Return</button>
                    <div id="fdErrorMessage" class="error-message"></div>
                    <div id="fdResult" class="mb-4 hidden">
                        <h3 class="text-lg font-semibold mb-2 mt-4">Calculation Results:</h3>
                        <div class="result-item">
                            <span class="result-label">Maturity Amount (Pre-Tax):</span>
                            <span class="result-value" id="fdMaturityPreTax"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Total Interest Earned:</span>
                            <span class="result-value" id="fdTotalInterest"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Estimated Tax Liability:</span>
                            <span class="result-value negative" id="fdTaxAmount"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Maturity Amount (Post-Tax):</span>
                            <span class="result-value" id="fdMaturityPostTax"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Post-Tax Nominal Return (CAGR):</span>
                            <span class="result-value" id="fdNominalReturnPostTax"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Real Return Rate (Post-Tax, Post-Inflation):</span>
                            <span class="result-value" id="fdRealReturn"></span>
                        </div>
                    </div>
                    <div class="mt-6">
                        <h3 class="text-lg font-semibold mb-2">Investment Growth (Pre-Tax)</h3>
                        <div class="relative h-64 md:h-80">
                             <canvas id="fdChart"></canvas>
                        </div>
                    </div>
                    <div class="insights-container">
                        <h4><i class="fa-solid fa-newspaper mr-2"></i>FD Insights (India)</h4>
                         <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-shield-halved"></i></span>
                             <span class="insight-text">FDs offer <strong>fixed, predictable returns</strong>, making them relatively safe compared to market-linked investments.</span>
                         </div>
                         <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-file-invoice-dollar"></i></span>
                             <span class="insight-text">Interest earned is added to your 'Income from Other Sources' and taxed annually at your applicable <strong>income tax slab rate</strong>.</span>
                         </div>
                         <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-percent"></i></span>
                             <span class="insight-text">Banks deduct <strong>TDS (Tax Deducted at Source)</strong> at 10% if interest exceeds ₹40,000 (₹50,000 for senior citizens) in a financial year. Your final liability depends on your slab.</span>
                         </div>
                         <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-repeat"></i></span>
                             <span class="insight-text"><strong>Compounding frequency</strong> matters: More frequent compounding (e.g., quarterly) leads to slightly higher returns than yearly compounding.</span>
                         </div>
                          <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-arrow-trend-down"></i></span>
                             <span class="insight-text"><strong>Inflation</strong> significantly erodes the purchasing power of fixed returns. Always consider the real return after inflation.</span>
                         </div>
                    </div>
                </div>

                <div id="mfSip-tab-content" class="tab-content hidden">
                    <h2 class="text-xl font-semibold mb-4 rh-text-dark">Mutual Fund (SIP) Calculator (Equity Funds)</h2>
                     <p class="text-sm text-gray-600 mb-4">Estimate potential returns and tax (Equity Fund rules with hypothetical rates) for SIP investments.</p>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label for="mfSipAmount" class="block text-sm font-medium text-gray-700 mb-1">Monthly SIP Amount (₹)</label>
                            <input type="number" id="mfSipAmount" class="input-field" placeholder="e.g., 10000">
                        </div>
                        <div>
                            <label for="mfSipDuration" class="block text-sm font-medium text-gray-700 mb-1">Investment Duration (Years)</label>
                            <input type="number" id="mfSipDuration" class="input-field" placeholder="e.g., 10">
                        </div>
                        <div>
                            <label for="mfSipExpectedReturn" class="block text-sm font-medium text-gray-700 mb-1">Expected Annual Return (%)</label>
                            <input type="number" id="mfSipExpectedReturn" class="input-field" placeholder="e.g., 12">
                        </div>
                        <div>
                            <label for="mfSipExpenseRatio" class="block text-sm font-medium text-gray-700 mb-1">Expense Ratio (%)</label>
                            <input type="number" id="mfSipExpenseRatio" class="input-field" placeholder="e.g., 1.5">
                            <p class="text-xs text-gray-500 mt-1">Annual fee charged by the fund house.</p>
                        </div>
                    </div>
                    <button id="mfSipCalculateBtn" onclick="calculateMFSIP(this)" class="btn-calculate mb-4">Calculate MF SIP Return</button>
                     <div id="mfSipErrorMessage" class="error-message"></div>
                     <div id="mfSipResult" class="mb-4 hidden">
                        <h3 class="text-lg font-semibold mb-2 mt-4">Calculation Results:</h3>
                        <div class="result-item">
                            <span class="result-label">Total Investment:</span>
                            <span class="result-value" id="mfSipTotalInvestment"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Expected Future Value (Pre-Tax):</span>
                            <span class="result-value" id="mfSipFutureValuePreTax"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Estimated Gain/Loss (Pre-Tax):</span>
                            <span class="result-value" id="mfSipGainPreTax"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Gain/Loss Type (on Redemption):</span>
                            <span class="result-value" id="mfSipGainType"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">
                                Estimated Tax Liability (Hypothetical Equity Rules)
                                <span class="info-icon-container">
                                    <i class="info-icon">i</i>
                                    <span class="tooltip-text" id="mfSipTaxLogicTooltip">Tax calculation details will appear here.</span>
                                </span>
                            </span>
                            <span class="result-value negative" id="mfSipTaxAmount"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Future Value (Post-Tax):</span>
                            <span class="result-value" id="mfSipFutureValuePostTax"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Post-Tax Nominal Return (CAGR):</span>
                            <span class="result-value" id="mfSipNominalReturnPostTax">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Real Return Rate (Post-Tax, Post-Inflation):</span>
                             <span class="result-value" id="mfSipRealReturn">-</span>
                        </div>
                    </div>
                    <div class="insights-container">
                        <h4><i class="fa-solid fa-newspaper mr-2"></i>Mutual Fund (SIP) Insights (Hypothetical Rates)</h4>
                         <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-calendar-days"></i></span>
                             <span class="insight-text"><strong>SIP (Systematic Investment Plan):</strong> Invest a fixed amount regularly, benefiting from <strong>rupee cost averaging</strong> (buying more units when prices are low, fewer when high). Ideal for disciplined long-term investing.</span>
                         </div>
                         <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-sliders"></i></span>
                             <span class="insight-text"><strong>Expense Ratio:</strong> An annual fee charged by the fund house, directly reducing your returns. Lower is generally better for long-term growth.</span>
                         </div>
                         <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-landmark"></i></span>
                             <span class="insight-text"><strong>Taxation (Equity Funds - Assumed Here):</strong> STCG (< 1 yr holding) taxed at <strong>20%</strong>. LTCG (> 1 yr holding) taxed at <strong>12.5%</strong> on gains exceeding ₹1 lakh per financial year. (Note: Tax applies per SIP installment's holding period, simplified here based on total duration).</span>
                         </div>
                          <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-triangle-exclamation"></i></span>
                             <span class="insight-text"><strong>Disclaimer:</strong> These tax rates (12.5% LTCG, 20% STCG) are hypothetical based on user request and may not reflect current official Indian tax laws.</span>
                         </div>
                          <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-circle-question"></i></span>
                             <span class="insight-text"><strong>Debt Funds</strong> have different tax rules (often taxed at slab rate). This calculator assumes Equity fund rules.</span>
                         </div>
                          <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-chart-line"></i></span>
                             <span class="insight-text">Returns are not guaranteed and depend on market performance. CAGR for SIP is complex and not calculated here.</span>
                         </div>
                    </div>
                </div>

                 <div id="mfLumpsum-tab-content" class="tab-content hidden">
                    <h2 class="text-xl font-semibold mb-4 rh-text-dark">Mutual Fund (Lumpsum) Calculator (Equity Funds)</h2>
                     <p class="text-sm text-gray-600 mb-4">Estimate potential returns and tax (Equity Fund rules with hypothetical rates) for Lumpsum investments.</p>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                         <div>
                            <label for="mfLumpsumAmount" class="block text-sm font-medium text-gray-700 mb-1">Lumpsum Investment Amount (₹)</label>
                            <input type="number" id="mfLumpsumAmount" class="input-field" placeholder="e.g., 120000">
                        </div>
                        <div>
                            <label for="mfLumpsumDuration" class="block text-sm font-medium text-gray-700 mb-1">Investment Duration (Years)</label>
                            <input type="number" id="mfLumpsumDuration" class="input-field" placeholder="e.g., 10">
                        </div>
                        <div>
                            <label for="mfLumpsumExpectedReturn" class="block text-sm font-medium text-gray-700 mb-1">Expected Annual Return (%)</label>
                            <input type="number" id="mfLumpsumExpectedReturn" class="input-field" placeholder="e.g., 12">
                        </div>
                        <div>
                            <label for="mfLumpsumExpenseRatio" class="block text-sm font-medium text-gray-700 mb-1">Expense Ratio (%)</label>
                            <input type="number" id="mfLumpsumExpenseRatio" class="input-field" placeholder="e.g., 1.5">
                            <p class="text-xs text-gray-500 mt-1">Annual fee charged by the fund house.</p>
                        </div>
                    </div>
                    <button id="mfLumpsumCalculateBtn" onclick="calculateMFLumpsum(this)" class="btn-calculate mb-4">Calculate MF Lumpsum Return</button>
                     <div id="mfLumpsumErrorMessage" class="error-message"></div>
                     <div id="mfLumpsumResult" class="mb-4 hidden">
                        <h3 class="text-lg font-semibold mb-2 mt-4">Calculation Results:</h3>
                        <div class="result-item">
                            <span class="result-label">Total Investment:</span>
                            <span class="result-value" id="mfLumpsumTotalInvestment"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Expected Future Value (Pre-Tax):</span>
                            <span class="result-value" id="mfLumpsumFutureValuePreTax"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Estimated Gain/Loss (Pre-Tax):</span>
                            <span class="result-value" id="mfLumpsumGainPreTax"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Gain/Loss Type (on Redemption):</span>
                            <span class="result-value" id="mfLumpsumGainType"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">
                                Estimated Tax Liability (Hypothetical Equity Rules)
                                <span class="info-icon-container">
                                    <i class="info-icon">i</i>
                                    <span class="tooltip-text" id="mfLumpsumTaxLogicTooltip">Tax calculation details will appear here.</span>
                                </span>
                            </span>
                            <span class="result-value negative" id="mfLumpsumTaxAmount"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Future Value (Post-Tax):</span>
                            <span class="result-value" id="mfLumpsumFutureValuePostTax"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Post-Tax Nominal Return (CAGR):</span>
                            <span class="result-value" id="mfLumpsumNominalReturnPostTax"></span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">Real Return Rate (Post-Tax, Post-Inflation):</span>
                            <span class="result-value" id="mfLumpsumRealReturn"></span>
                        </div>
                    </div>
                     <div class="insights-container">
                        <h4><i class="fa-solid fa-newspaper mr-2"></i>Mutual Fund (Lumpsum) Insights (Hypothetical Rates)</h4>
                         <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-sack-dollar"></i></span>
                             <span class="insight-text"><strong>Lumpsum:</strong> Invest a large amount at once. Market timing can impact returns significantly compared to SIP.</span>
                         </div>
                         <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-sliders"></i></span>
                             <span class="insight-text"><strong>Expense Ratio:</strong> An annual fee charged by the fund house, directly reducing your returns. Lower is generally better for long-term growth.</span>
                         </div>
                         <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-landmark"></i></span>
                             <span class="insight-text"><strong>Taxation (Equity Funds - Assumed Here):</strong> STCG (< 1 yr holding) taxed at <strong>20%</strong>. LTCG (> 1 yr holding) taxed at <strong>12.5%</strong> on gains exceeding ₹1 lakh per financial year.</span>
                         </div>
                          <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-triangle-exclamation"></i></span>
                             <span class="insight-text"><strong>Disclaimer:</strong> These tax rates (12.5% LTCG, 20% STCG) are hypothetical based on user request and may not reflect current official Indian tax laws.</span>
                         </div>
                          <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-circle-question"></i></span>
                             <span class="insight-text"><strong>Debt Funds</strong> have different tax rules (often taxed at slab rate). This calculator assumes Equity fund rules.</span>
                         </div>
                          <div class="insight-item">
                             <span class="insight-icon"><i class="fa-solid fa-chart-line"></i></span>
                             <span class="insight-text">Returns are not guaranteed and depend on market performance. CAGR is calculated for Lumpsum.</span>
                         </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center mt-8 text-gray-500 text-sm">
            <p>Disclaimer: This calculator provides estimates for informational purposes only. Tax laws and rates are subject to change and may differ from the hypothetical rates used here. Consult with a qualified financial advisor for personalized advice.</p>
        </footer>

    </div>

    <script>
        // --- Global Variables ---
        let fdChartInstance = null;
        // Define Tax Rates (Hypothetical - based on user request)
        const LTCG_TAX_RATE = 0.125; // 12.5%
        const STCG_TAX_RATE = 0.20; // 20%
        const LTCG_EXEMPTION = 100000; // ₹1 Lakh

        // --- Helper Functions ---
        const formatCurrency = (value) => {
            if (isNaN(value) || value === null || !isFinite(value)) return '₹ 0.00';
            const roundedValue = Math.round(value * 100) / 100;
            return `₹ ${roundedValue.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        };

        const formatPercentage = (value) => {
             if (isNaN(value) || value === null || !isFinite(value)) return '0.00%';
             if (value === -1) return '-100.00%';
             const percentageValue = (value * 100).toFixed(2);
             return `${percentageValue}%`;
        }

        const getNumberValue = (id) => {
            const value = document.getElementById(id).value;
            if (value === null || value.trim() === '') return NaN;
            const num = parseFloat(value);
            return isNaN(num) ? NaN : num;
        };
        const getSelectedValue = (id) => document.getElementById(id).value;

        // Displays calculation results in the specified section
        const displayResult = (sectionId, results) => {
            const resultDiv = document.getElementById(`${sectionId}Result`);
            if (!resultDiv) {
                console.error(`Result container not found for section: ${sectionId}`);
                return;
            }
            resultDiv.classList.remove('hidden');

            for (const key in results) {
                const elementId = `${sectionId}${key.charAt(0).toUpperCase() + key.slice(1)}`;
                const element = document.getElementById(elementId);

                if (element) {
                    let value = results[key];
                    let displayValue = '-';

                    if (typeof value === 'number' && !isNaN(value)) {
                        if (key.toLowerCase().includes('return') || key.toLowerCase().includes('rate')) {
                            displayValue = formatPercentage(value);
                        } else {
                            displayValue = formatCurrency(value);
                        }
                    } else if (typeof value === 'string') {
                         displayValue = value;
                    }

                    // Update the element's text content
                    if (key.toLowerCase() === 'taxlogictooltip') {
                         const tooltipElementId = `${sectionId}TaxLogicTooltip`;
                         const tooltipElement = document.getElementById(tooltipElementId);
                         if(tooltipElement) {
                             tooltipElement.textContent = value;
                         }
                    } else if (displayValue !== undefined) {
                       element.textContent = displayValue;
                    }

                    // Apply positive/negative styling
                    if (element.classList.contains('result-value')) {
                        element.classList.remove('positive', 'negative');
                        if (key.toLowerCase().includes('taxamount') && typeof value === 'number' && value > 0) {
                            element.classList.add('negative');
                        } else if (key.toLowerCase().includes('gain') || key.toLowerCase().includes('return')) {
                            if (typeof value === 'number' && value > 0) element.classList.add('positive');
                            else if (typeof value === 'number' && value < 0) element.classList.add('negative');
                        } else if (key.toLowerCase().includes('posttax')) {
                            let investmentValue = NaN;
                            const investmentKeyLower = `${sectionId}TotalInvestment`.toLowerCase();
                            const actualInvestmentKey = Object.keys(results).find(k => k.toLowerCase() === investmentKeyLower);
                            if (actualInvestmentKey) investmentValue = results[actualInvestmentKey];

                            if (!isNaN(investmentValue) && typeof value === 'number') {
                                if (value > investmentValue) element.classList.add('positive');
                                else if (value < investmentValue) element.classList.add('negative');
                            } else if (typeof value === 'number' && value > 0) {
                                element.classList.add('positive');
                            } else if (typeof value === 'number' && value < 0) {
                                element.classList.add('negative');
                            }
                        } else if (typeof value === 'number' && value > 0) {
                            element.classList.add('positive');
                        } else if (typeof value === 'number' && value < 0) {
                            element.classList.add('negative');
                        }
                    }
                }
            }
        };


        // Hides result & error message for a section
        const hideResultAndError = (sectionId) => {
            const resultDiv = document.getElementById(`${sectionId}Result`);
            const errorDiv = document.getElementById(`${sectionId}ErrorMessage`);
            if(resultDiv) resultDiv.classList.add('hidden');
            if(errorDiv) {
                errorDiv.classList.add('hidden');
                errorDiv.textContent = '';
            }
             const globalErrorDiv = document.getElementById('globalErrorMessage');
             if(globalErrorDiv) {
                 globalErrorDiv.classList.add('hidden');
                 globalErrorDiv.textContent = '';
             }
             // Also hide MF tooltips text when clearing results
             const sipTooltipElement = document.getElementById('mfSipTaxLogicTooltip');
             if(sipTooltipElement) sipTooltipElement.textContent = 'Tax calculation details will appear here.';
             const lumpsumTooltipElement = document.getElementById('mfLumpsumTaxLogicTooltip');
             if(lumpsumTooltipElement) lumpsumTooltipElement.textContent = 'Tax calculation details will appear here.';

        };

        // Displays an error message in the specified section's error div
        const showErrorMessage = (sectionId, message) => {
             const errorDiv = document.getElementById(`${sectionId}ErrorMessage`);
             if(errorDiv) {
                 errorDiv.textContent = message;
                 errorDiv.classList.remove('hidden');
             }
             const resultDiv = document.getElementById(`${sectionId}Result`);
             if(resultDiv) resultDiv.classList.add('hidden');
        };

        // Gets the global inflation rate, shows error in global section
        const getInflationRate = () => {
             const globalErrorDiv = document.getElementById('globalErrorMessage');
             if(globalErrorDiv) {
                 globalErrorDiv.classList.add('hidden');
                 globalErrorDiv.textContent = '';
             }
            const rateInput = document.getElementById('inflationRate');
            const rate = getNumberValue('inflationRate');
            if (isNaN(rate) || rate < 0) {
                 if(globalErrorDiv) {
                    globalErrorDiv.textContent = 'Please enter a valid non-negative Inflation Rate.';
                    globalErrorDiv.classList.remove('hidden');
                 }
                 if (rateInput) rateInput.focus();
                return NaN;
            }
            return rate / 100;
        };

        // --- Confetti Trigger ---
        function triggerConfetti(buttonElement, options = {}) {
            if (!buttonElement || typeof confetti !== 'function') return;
            const rect = buttonElement.getBoundingClientRect();
            const originX = (rect.left + rect.width / 2) / window.innerWidth;
            const originY = (rect.top + rect.height / 2) / window.innerHeight;
            const defaults = { particleCount: 100, spread: 70, origin: { x: originX, y: originY } };
            confetti({ ...defaults, ...options });
        }

        // --- Tab Switching Logic ---
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            const tabContent = document.getElementById(`${tabId}-tab-content`);
            if (tabContent) tabContent.classList.remove('hidden');
            const tabButton = document.querySelector(`.tab-button[onclick="switchTab('${tabId}')"]`);
             if (tabButton) tabButton.classList.add('active');

            if (tabId === 'fd') {
                const fdResultDiv = document.getElementById('fdResult');
                 if (fdResultDiv && !fdResultDiv.classList.contains('hidden')) {
                    if (!fdChartInstance) {
                         const principal = getNumberValue('fdPrincipal');
                         const rate = getNumberValue('fdRate') / 100;
                         const time = getNumberValue('fdTime');
                         const compoundFreq = parseInt(getSelectedValue('fdCompoundFreq'));
                         if (!isNaN(principal) && !isNaN(rate) && !isNaN(time) && !isNaN(compoundFreq)) {
                             updateFDChart(principal, rate, time, compoundFreq);
                         }
                    }
                 } else {
                     if (fdChartInstance) { fdChartInstance.destroy(); fdChartInstance = null; }
                 }
            } else {
                 if (fdChartInstance) { fdChartInstance.destroy(); fdChartInstance = null; }
            }
        }

        // --- FD Calculator ---
        function calculateFD(buttonElement) {
            hideResultAndError('fd');
            const principal = getNumberValue('fdPrincipal');
            const rate = getNumberValue('fdRate') / 100;
            const time = getNumberValue('fdTime');
            const compoundFreq = parseInt(getSelectedValue('fdCompoundFreq'));
            const taxBracket = getNumberValue('fdTaxBracket') / 100;
            const inflationRate = getInflationRate();

            let errors = [];
            if (isNaN(principal) || principal <= 0) errors.push("Principal Amount must be positive.");
            if (isNaN(rate) || rate <= 0) errors.push("Annual Interest Rate must be positive.");
            if (isNaN(time) || time <= 0) errors.push("Time Period must be positive.");
            if (isNaN(taxBracket) || taxBracket < 0 || taxBracket > 1) errors.push("Invalid Tax Slab selected.");
            if (isNaN(inflationRate)) errors.push("Valid Inflation Rate is required.");

            if (errors.length > 0) {
                showErrorMessage('fd', errors.join(' '));
                 if (fdChartInstance) { fdChartInstance.destroy(); fdChartInstance = null; }
                return;
            }

            const n = compoundFreq;
            const nt = n * time;
            const maturityAmountPreTax = principal * Math.pow(1 + rate / n, nt);
            const totalInterest = maturityAmountPreTax - principal;
            const totalTax = totalInterest * taxBracket;
            const maturityAmountPostTax = maturityAmountPreTax - totalTax;

            let postTaxNominalReturn = 0;
            if (principal > 0 && maturityAmountPostTax > 0 && time > 0) {
                 postTaxNominalReturn = Math.pow(maturityAmountPostTax / principal, 1 / time) - 1;
            } else if (maturityAmountPostTax <= 0 && principal > 0) {
                 postTaxNominalReturn = -1;
            }

            const realReturn = (1 + postTaxNominalReturn) / (1 + inflationRate) - 1;

            displayResult('fd', {
                maturityPreTax: maturityAmountPreTax,
                totalInterest: totalInterest,
                taxAmount: totalTax,
                maturityPostTax: maturityAmountPostTax,
                nominalReturnPostTax: postTaxNominalReturn,
                realReturn: realReturn
            });
            updateFDChart(principal, rate, time, compoundFreq);
            triggerConfetti(buttonElement);
        }

        function updateFDChart(principal, rate, time, compoundFreq) {
             const canvas = document.getElementById('fdChart');
             if (!canvas) return;
             const ctx = canvas.getContext('2d');
             if (!ctx) return;
             if (fdChartInstance) fdChartInstance.destroy();
             const chartLabels = []; const chartDataValues = []; const chartPrincipalValues = [];
             const pointsPerYear = 4; const totalPoints = Math.ceil(time * pointsPerYear);
             for (let i = 0; i <= totalPoints; i++) {
                 const currentYear = i / pointsPerYear; if (currentYear > time) continue;
                 const currentBalance = principal * Math.pow(1 + rate / compoundFreq, compoundFreq * currentYear);
                 chartLabels.push(currentYear.toFixed(currentYear % 1 === 0 ? 0 : 2));
                 chartDataValues.push(currentBalance); chartPrincipalValues.push(principal);
             }
             const lastCalculatedYear = totalPoints / pointsPerYear;
             if (Math.abs(lastCalculatedYear - time) > 1e-9 && time > lastCalculatedYear) {
                 const finalBalance = principal * Math.pow(1 + rate / compoundFreq, compoundFreq * time);
                 chartLabels.push(time.toFixed(time % 1 === 0 ? 0 : 2));
                 chartDataValues.push(finalBalance); chartPrincipalValues.push(principal);
             }
             fdChartInstance = new Chart(ctx, { /* Chart config */
                 type: 'line', data: { labels: chartLabels, datasets: [{ label: 'Total Value (Pre-Tax)', data: chartDataValues, borderColor: 'var(--rh-green)', backgroundColor: 'rgba(0, 200, 5, 0.1)', fill: true, tension: 0.2, pointRadius: 0, pointHoverRadius: 4 }, { label: 'Principal', data: chartPrincipalValues, borderColor: '#9ca3af', borderDash: [5, 5], fill: false, tension: 0.2, pointRadius: 0 }] },
                 options: { responsive: true, maintainAspectRatio: false, scales: { x: { title: { display: true, text: 'Years' }, ticks: { autoSkip: true, maxTicksLimit: 10 } }, y: { beginAtZero: true, ticks: { callback: function(value) { return formatCurrency(value); } }, title: { display: true, text: 'Amount (₹)' } } }, plugins: { tooltip: { mode: 'index', intersect: false, callbacks: { title: function(tooltipItems) { return `Year: ${tooltipItems[0].label}`; }, label: function(context) { let label = context.dataset.label || ''; if (label) { label += ': '; } label += formatCurrency(context.parsed.y); return label; } } } }, hover: { mode: 'nearest', intersect: true } }
             });
         }

        // --- MF SIP Calculator ---
        function calculateMFSIP(buttonElement) {
            hideResultAndError('mfSip');
            const sipAmount = getNumberValue('mfSipAmount');
            const duration = getNumberValue('mfSipDuration');
            const expectedReturn = getNumberValue('mfSipExpectedReturn') / 100;
            const expenseRatio = getNumberValue('mfSipExpenseRatio') / 100;
            const inflationRate = getInflationRate();

            let errors = [];
            if (isNaN(sipAmount) || sipAmount <= 0) errors.push("Monthly SIP Amount must be positive.");
            if (isNaN(duration) || duration <= 0) errors.push("Investment Duration must be positive.");
            if (isNaN(expectedReturn) || expectedReturn < 0) errors.push("Expected Annual Return cannot be negative.");
            if (isNaN(expenseRatio) || expenseRatio < 0) errors.push("Expense Ratio cannot be negative.");
            if (isNaN(inflationRate)) errors.push("Valid Inflation Rate is required.");

             if (errors.length > 0) {
                showErrorMessage('mfSip', errors.join(' '));
                return;
            }

            const adjustedReturn = Math.max(-1, expectedReturn - expenseRatio);
            const totalInvestment = sipAmount * 12 * duration;
            const monthlyRate = adjustedReturn / 12;
            const numMonths = duration * 12;
            let futureValuePreTax = 0;

             if (Math.abs(monthlyRate) < 1e-9) {
                futureValuePreTax = sipAmount * numMonths;
            } else {
                futureValuePreTax = sipAmount * (Math.pow(1 + monthlyRate, numMonths) - 1) / monthlyRate * (1 + monthlyRate);
            }
            futureValuePreTax = Math.max(0, futureValuePreTax);
            const gainPreTax = futureValuePreTax - totalInvestment;

            let gainType = '';
            let taxAmount = 0;
            let taxLogicText = 'No tax on losses.';

            if (gainPreTax <= 0) {
                 gainType = duration <= 1 ? 'STCL (Short-Term Capital Loss)' : 'LTCL (Long-Term Capital Loss)';
                 taxAmount = 0;
            } else if (duration <= 1) {
                gainType = 'STCG (Short-Term)';
                taxAmount = gainPreTax * STCG_TAX_RATE;
                taxLogicText = `STCG: ${formatCurrency(gainPreTax)} * ${formatPercentage(STCG_TAX_RATE)} = ${formatCurrency(taxAmount)}`;
            } else {
                gainType = 'LTCG (Long-Term)';
                const taxableLTCG = Math.max(0, gainPreTax - LTCG_EXEMPTION);
                taxAmount = taxableLTCG * LTCG_TAX_RATE;
                taxLogicText = `LTCG: Max(0, ${formatCurrency(gainPreTax)} - ${formatCurrency(LTCG_EXEMPTION)}) * ${formatPercentage(LTCG_TAX_RATE)} = ${formatCurrency(taxableLTCG)} * ${formatPercentage(LTCG_TAX_RATE)} = ${formatCurrency(taxAmount)}`;
            }

            const futureValuePostTax = Math.max(0, futureValuePreTax - taxAmount);
            const postTaxNominalReturn = NaN; // CAGR not calculated for SIP
            const realReturn = NaN; // Real return depends on CAGR

            displayResult('mfSip', {
                totalInvestment: totalInvestment,
                futureValuePreTax: futureValuePreTax,
                gainPreTax: gainPreTax,
                gainType: gainType,
                taxAmount: taxAmount,
                taxLogicTooltip: taxLogicText,
                futureValuePostTax: futureValuePostTax,
                nominalReturnPostTax: postTaxNominalReturn,
                realReturn: realReturn
            });
            triggerConfetti(buttonElement);
        }

         // --- MF Lumpsum Calculator ---
        function calculateMFLumpsum(buttonElement) {
            hideResultAndError('mfLumpsum');
            const lumpsumAmount = getNumberValue('mfLumpsumAmount');
            const duration = getNumberValue('mfLumpsumDuration');
            const expectedReturn = getNumberValue('mfLumpsumExpectedReturn') / 100;
            const expenseRatio = getNumberValue('mfLumpsumExpenseRatio') / 100;
            const inflationRate = getInflationRate();

            let errors = [];
            if (isNaN(lumpsumAmount) || lumpsumAmount <= 0) errors.push("Lumpsum Investment Amount must be positive.");
            if (isNaN(duration) || duration <= 0) errors.push("Investment Duration must be positive.");
            if (isNaN(expectedReturn) || expectedReturn < 0) errors.push("Expected Annual Return cannot be negative.");
            if (isNaN(expenseRatio) || expenseRatio < 0) errors.push("Expense Ratio cannot be negative.");
            if (isNaN(inflationRate)) errors.push("Valid Inflation Rate is required.");

             if (errors.length > 0) {
                showErrorMessage('mfLumpsum', errors.join(' '));
                return;
            }

            const adjustedReturn = Math.max(-1, expectedReturn - expenseRatio);
            const totalInvestment = lumpsumAmount;
            let futureValuePreTax = lumpsumAmount * Math.pow(1 + adjustedReturn, duration);

            futureValuePreTax = Math.max(0, futureValuePreTax);
            const gainPreTax = futureValuePreTax - totalInvestment;

            let gainType = '';
            let taxAmount = 0;
            let taxLogicText = 'No tax on losses.';

            if (gainPreTax <= 0) {
                 gainType = duration <= 1 ? 'STCL (Short-Term Capital Loss)' : 'LTCL (Long-Term Capital Loss)';
                 taxAmount = 0;
            } else if (duration <= 1) {
                gainType = 'STCG (Short-Term)';
                taxAmount = gainPreTax * STCG_TAX_RATE;
                taxLogicText = `STCG: ${formatCurrency(gainPreTax)} * ${formatPercentage(STCG_TAX_RATE)} = ${formatCurrency(taxAmount)}`;
            } else {
                gainType = 'LTCG (Long-Term)';
                const taxableLTCG = Math.max(0, gainPreTax - LTCG_EXEMPTION);
                taxAmount = taxableLTCG * LTCG_TAX_RATE;
                taxLogicText = `LTCG: Max(0, ${formatCurrency(gainPreTax)} - ${formatCurrency(LTCG_EXEMPTION)}) * ${formatPercentage(LTCG_TAX_RATE)} = ${formatCurrency(taxableLTCG)} * ${formatPercentage(LTCG_TAX_RATE)} = ${formatCurrency(taxAmount)}`;
            }

            const futureValuePostTax = Math.max(0, futureValuePreTax - taxAmount);
            let postTaxNominalReturn = NaN;

            if (totalInvestment > 0) {
                 if (futureValuePostTax > 0 && duration > 0) {
                     postTaxNominalReturn = Math.pow(futureValuePostTax / totalInvestment, 1 / duration) - 1;
                 } else if (futureValuePostTax <= 0) {
                     postTaxNominalReturn = -1;
                 }
            }

            const realReturn = isNaN(postTaxNominalReturn) ? NaN : (1 + postTaxNominalReturn) / (1 + inflationRate) - 1;

            displayResult('mfLumpsum', {
                totalInvestment: totalInvestment,
                futureValuePreTax: futureValuePreTax,
                gainPreTax: gainPreTax,
                gainType: gainType,
                taxAmount: taxAmount,
                taxLogicTooltip: taxLogicText,
                futureValuePostTax: futureValuePostTax,
                nominalReturnPostTax: postTaxNominalReturn,
                realReturn: realReturn
            });
            triggerConfetti(buttonElement);
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            switchTab('fd'); // Start with FD tab active
        });

    </script>

</body>
</html>
